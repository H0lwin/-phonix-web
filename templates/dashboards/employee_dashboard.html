{% extends "dashboards/base_dashboard.html" %}

{% block tabs_nav %}
<!-- تب های کارمند -->
<button class="tab-nav-btn active" data-tab="overview">
    <span class="tab-nav-icon">📊</span>
    <span class="tab-nav-text">نمای کلی</span>
</button>

<button class="tab-nav-btn" data-tab="attendance">
    <span class="tab-nav-icon">🕐</span>
    <span class="tab-nav-text">حضور و غیاب</span>
</button>

<button class="tab-nav-btn" data-tab="leave">
    <span class="tab-nav-icon">🏖️</span>
    <span class="tab-nav-text">درخواست مرخصی</span>
</button>

<button class="tab-nav-btn" data-tab="loans">
    <span class="tab-nav-icon">🏦</span>
    <span class="tab-nav-text">وام‌ها</span>
</button>

<button class="tab-nav-btn" data-tab="services">
    <span class="tab-nav-icon">🛠️</span>
    <span class="tab-nav-text">خدمات</span>
</button>

<!-- پیوند صفحه اول -->
<a href="{% url 'core:index' %}" class="nav-item">
    <span class="nav-icon">🏠</span>
    <span>صفحه اول</span>
</a>
{% endblock %}

{% block content %}
<div class="dashboard-tabs">
    <!-- بخش: نمای کلی -->
    <div class="tab-content active" id="overview-tab">
        <div class="tab-header">
            <h2>نمای کلی</h2>
        </div>

        <!-- ردیف آمار -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-icon">📊</div>
                <div class="stat-info">
                    <p class="stat-value">{{ total_cases }}</p>
                    <p class="stat-label">کل پرونده‌ها</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">⏳</div>
                <div class="stat-info">
                    <p class="stat-value">{{ pending_cases }}</p>
                    <p class="stat-label">پرونده‌های منتظر</p>
                </div>
            </div>
        </div>

        <!-- بخش تمام پرونده‌ها -->
        <div class="section-full">
            <div class="section-header">
                <h2>تمام پرونده‌ها</h2>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>شماره پرونده</th>
                            <th>عنوان</th>
                            <th>وکیل مسئول</th>
                            <th>وضعیت</th>
                            <th>تاریخ ایجاد</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for case in recent_cases %}
                        <tr>
                            <td><strong>{{ case.case_number }}</strong></td>
                            <td>{{ case.title }}</td>
                            <td>
                                {% if case.assigned_lawyer %}
                                    {{ case.assigned_lawyer.first_name }} {{ case.assigned_lawyer.last_name }}
                                {% else %}
                                    <span class="badge unassigned">تعیین نشده</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge status-{{ case.status }}">
                                    {% if case.status == 'pending' %}
                                        در انتظار
                                    {% elif case.status == 'in_progress' %}
                                        در حال بررسی
                                    {% elif case.status == 'completed' %}
                                        تکمیل‌شده
                                    {% else %}
                                        بسته‌شده
                                    {% endif %}
                                </span>
                            </td>
                            <td>{{ case.created_at|date:"Y-m-d" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center text-muted">هیچ پرونده‌ای موجود نیست</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- اطلاعات کارمند -->
        <div class="info-section">
            <h3>اطلاعات من</h3>
            <div class="info-card">
                <div class="info-item">
                    <span class="info-label">نام:</span>
                    <span class="info-value">{{ user.first_name }} {{ user.last_name }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ایمیل:</span>
                    <span class="info-value">{{ user.email }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">بخش:</span>
                    <span class="info-value">{{ user.profile.department }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">تلفن:</span>
                    <span class="info-value">{{ user.profile.phone }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- بخش: حضور و غیاب -->
    <div class="tab-content" id="attendance-tab">
        <div class="tab-header">
            <h2>🕐 ثبت حضور و غیاب</h2>
        </div>

        <!-- ستاتوس امروز -->
        <div class="attendance-status">
            <div class="status-card">
                <div class="status-content">
                    <h3>وضعیت امروز</h3>
                    <div class="status-info" id="attendanceStatus">
                        <p class="loading-text">درحال بارگذاری...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- دکمه‌های ورود و خروج -->
        <div class="attendance-actions">
            <button id="checkInBtn" class="btn btn-success btn-lg" style="display: none;">
                <span class="btn-icon">✅</span>
                <span class="btn-text">ورود به سیستم</span>
            </button>
            <button id="checkOutBtn" class="btn btn-danger btn-lg" style="display: none;">
                <span class="btn-icon">🚪</span>
                <span class="btn-text">خروج از سیستم</span>
            </button>
            <div id="actionMessage" class="message-box" style="display: none;"></div>
        </div>

        <!-- تاریخچه حضور هفتگی -->
        <div class="section-full">
            <div class="section-header">
                <h2>تاریخچه حضور (۷ روز اخیر)</h2>
            </div>

            <div class="table-container">
                <table class="data-table attendance-table">
                    <thead>
                        <tr>
                            <th>تاریخ</th>
                            <th>زمان ورود</th>
                            <th>زمان خروج</th>
                            <th>مدت کار</th>
                            <th>اضافه‌کاری</th>
                            <th>وضعیت</th>
                        </tr>
                    </thead>
                    <tbody id="attendanceTable">
                        <tr>
                            <td colspan="6" class="text-center text-muted">درحال بارگذاری...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- آمار حضور ماهانه -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-icon">📅</div>
                <div class="stat-info">
                    <p class="stat-value" id="totalDays">-</p>
                    <p class="stat-label">روز حضور</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">⏰</div>
                <div class="stat-info">
                    <p class="stat-value" id="totalHours">-</p>
                    <p class="stat-label">کل ساعات کار</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">⚡</div>
                <div class="stat-info">
                    <p class="stat-value" id="totalOvertime">-</p>
                    <p class="stat-label">اضافه‌کاری</p>
                </div>
            </div>
        </div>
    </div>

    <!-- بخش: درخواست مرخصی -->
    <div class="tab-content" id="leave-tab">
        <div class="tab-header">
            <h2>🏖️ درخواست مرخصی</h2>
        </div>

        <div style="text-align: center; padding: 40px;">
            <p style="font-size: 18px; margin-bottom: 30px;">برای درخواست مرخصی، لطفاً به صفحه درخواست بروید</p>
            <a href="{% url 'core:employee_leave_request' %}" class="btn btn-primary btn-lg">
                <span class="btn-icon">📋</span>
                <span class="btn-text">درخواست مرخصی جدید</span>
            </a>
        </div>
    </div>

    <!-- بخش: وام‌ها -->
    <div class="tab-content" id="loans-tab">
        <div class="tab-header">
            <h2>وام‌ها</h2>
            <div class="subtabs-nav">
                <button class="subtab-btn active" data-subtab="loans-list">📋 وام‌ها</button>
                <button class="subtab-btn" data-subtab="loans-buyers">👥 خریداران وام</button>
            </div>
        </div>

        <div class="subtab-content active" id="loans-list-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>لیست وام‌ها</h3>
                </div>
                <div class="empty-state">
                    <p>🔄 بخش وام‌ها (در حال توسعه)</p>
                </div>
            </div>
        </div>

        <div class="subtab-content" id="loans-buyers-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>خریداران وام</h3>
                </div>
                <div class="empty-state">
                    <p>🔄 بخش خریداران وام (در حال توسعه)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- بخش: خدمات -->
    <div class="tab-content" id="services-tab">
        <div class="tab-header">
            <h2>خدمات</h2>
        </div>
        <div class="empty-state">
            <p>🔄 این بخش در حال توسعه است</p>
        </div>
    </div>
</div>
{% endblock %}