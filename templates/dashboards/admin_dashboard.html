{% extends "dashboards/base_dashboard.html" %}
{% load static %}

{% block tabs_nav %}
<!-- ØªØ¨ Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ù…Ø¯ÛŒØ± -->
<button class="tab-nav-btn active" data-tab="overview">
    <span class="tab-nav-icon">ğŸ“Š</span>
    <span class="tab-nav-text">Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ</span>
</button>

<button class="tab-nav-btn" data-tab="hr">
    <span class="tab-nav-icon">ğŸ‘¥</span>
    <span class="tab-nav-text">Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø³Ø§Ù†ÛŒ</span>
</button>

<button class="tab-nav-btn" data-tab="finance">
    <span class="tab-nav-icon">ğŸ’°</span>
    <span class="tab-nav-text">Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§Ù„ÛŒ</span>
</button>

<button class="tab-nav-btn" data-tab="loans">
    <span class="tab-nav-icon">ğŸ¦</span>
    <span class="tab-nav-text">ÙˆØ§Ù…â€ŒÙ‡Ø§</span>
</button>

<button class="tab-nav-btn" data-tab="services">
    <span class="tab-nav-icon">ğŸ› ï¸</span>
    <span class="tab-nav-text">Ø®Ø¯Ù…Ø§Øª</span>
</button>

<button class="tab-nav-btn" data-tab="cases">
    <span class="tab-nav-icon">ğŸ“‹</span>
    <span class="tab-nav-text">Ù¾Ø±ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§</span>
</button>

<hr style="border: none; border-top: 1px solid rgba(255, 255, 255, 0.1); margin: 1rem 0;">

<!-- Ù¾ÛŒÙˆÙ†Ø¯Ù‡Ø§ÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ -->
<a href="{% url 'core:index' %}" class="nav-item">
    <span class="nav-icon">ğŸ </span>
    <span>ØµÙØ­Ù‡ Ø§ÙˆÙ„</span>
</a>

<a href="{% url 'admin:index' %}" class="nav-item">
    <span class="nav-icon">âš™ï¸</span>
    <span>Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÛŒØ³ØªÙ…</span>
</a>
{% endblock %}

{% block content %}
<div class="dashboard-tabs">
    <!-- Ø¨Ø®Ø´: Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ -->
    <div class="tab-content active" id="overview-tab">
        <div class="tab-header">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <h2>Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ</h2>
                <div style="text-align: right;">
                    <p style="margin: 0; font-size: 14px; color: #888;">Ø®ÙˆØ´ Ø§Ù…Ø¯ÛŒØ¯</p>
                    <p style="margin: 0; font-size: 16px; font-weight: bold;">{{ user.first_name }} {{ user.last_name }} ({{ user_role }})</p>
                </div>
            </div>
        </div>

        <!-- Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-info">
                    <p class="stat-value">{{ monthly_profit|floatformat:0 }}</p>
                    <p class="stat-label">Ø³ÙˆØ¯ Ø§ÛŒÙ† Ù…Ø§Ù‡</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">ğŸ’°</div>
                <div class="stat-info">
                    <p class="stat-value">{{ loans_sold_this_month }}</p>
                    <p class="stat-label">ÙˆØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙØ±ÙˆØ´ Ø±ÙØªÙ‡</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">ğŸ¦</div>
                <div class="stat-info">
                    <p class="stat-value">{{ available_loans }}</p>
                    <p class="stat-label">ÙˆØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">âŒ</div>
                <div class="stat-info">
                    <p class="stat-value">{{ absent_employees|length }}</p>
                    <p class="stat-label">Ø§ÙØ±Ø§Ø¯ ØºØ§Ø¦Ø¨ Ø§Ù…Ø±ÙˆØ²</p>
                </div>
            </div>
        </div>

        <!-- Ø±Ø¯ÛŒÙ Ø¢Ù…Ø§Ø± Ø¯ÙˆÙ… -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-icon users">ğŸ‘¥</div>
                <div class="stat-info">
                    <p class="stat-value">{{ total_users }}</p>
                    <p class="stat-label">Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon cases">ğŸ“‹</div>
                <div class="stat-info">
                    <p class="stat-value">{{ total_cases }}</p>
                    <p class="stat-label">Ú©Ù„ Ù¾Ø±ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon lawyers">âš–ï¸</div>
                <div class="stat-info">
                    <p class="stat-value">{{ total_lawyers }}</p>
                    <p class="stat-label">ØªØ¹Ø¯Ø§Ø¯ ÙˆÚ©Ù„Ø§</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon employees">ğŸ’¼</div>
                <div class="stat-info">
                    <p class="stat-value">{{ total_employees }}</p>
                    <p class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù†</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon pending">â³</div>
                <div class="stat-info">
                    <p class="stat-value">{{ pending_cases }}</p>
                    <p class="stat-label">Ù¾Ø±ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">ğŸ”</div>
                <div class="stat-info">
                    <p class="stat-value">{% if session_expiry %}{{ session_expiry|date:"H:i" }}{% else %}---{% endif %}</p>
                    <p class="stat-label">Ù…Ù‡Ù„Øª Ø¬Ù„Ø³Ù‡ ØªØ§</p>
                </div>
            </div>
        </div>

        <!-- Ø¨Ø®Ø´ ÙØ¹Ø§Ù„ÛŒØª Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ± -->
        <div class="section-full">
            <div class="section-header">
                <h2>ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h2>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ú©Ø§Ø±Ù…Ù†Ø¯</th>
                            <th>Ø¹Ù†ÙˆØ§Ù† ÙØ¹Ø§Ù„ÛŒØª</th>
                            <th>Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±ÛŒ</th>
                            <th>ØªØ§Ø±ÛŒØ®</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for activity in recent_activities %}
                        <tr>
                            <td>{{ activity.employee.user.first_name }} {{ activity.employee.user.last_name }}</td>
                            <td>{{ activity.title }}</td>
                            <td>{{ activity.hours_worked }}</td>
                            <td>{{ activity.date|date:"Y-m-d" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">Ù‡ÛŒÚ† ÙØ¹Ø§Ù„ÛŒØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ø¨Ø®Ø´ Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù† ØºØ§Ø¦Ø¨ -->
        {% if absent_employees %}
        <div class="section-full">
            <div class="section-header">
                <h2>Ø§ÙØ±Ø§Ø¯ ØºØ§Ø¦Ø¨ Ø§Ù…Ø±ÙˆØ²</h2>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ù†Ø§Ù… Ú©Ø§Ø±Ù…Ù†Ø¯</th>
                            <th>Ù…ÙˆØ¶Ø¹</th>
                            <th>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for attendance in absent_employees %}
                        <tr>
                            <td>{{ attendance.employee.user.first_name }} {{ attendance.employee.user.last_name }}</td>
                            <td><span class="badge status-absent">ØºØ§ÛŒØ¨</span></td>
                            <td>{{ attendance.notes|default:"Ø¨Ø¯ÙˆÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        <!-- Ø¨Ø®Ø´ Ø¢Ø®Ø±ÛŒÙ† Ù¾Ø±ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ -->
        <div class="section-full">
            <div class="section-header">
                <h2>Ø¢Ø®Ø±ÛŒÙ† Ù¾Ø±ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§</h2>
                <a href="{% url 'admin:index' %}" class="btn btn-small">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡</a>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±ÙˆÙ†Ø¯Ù‡</th>
                            <th>Ø¹Ù†ÙˆØ§Ù†</th>
                            <th>ÙˆÚ©ÛŒÙ„ Ù…Ø³Ø¦ÙˆÙ„</th>
                            <th>ÙˆØ¶Ø¹ÛŒØª</th>
                            <th>ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for case in recent_cases %}
                        <tr>
                            <td><strong>{{ case.case_number }}</strong></td>
                            <td>{{ case.title }}</td>
                            <td>
                                {% if case.assigned_lawyer %}
                                    {{ case.assigned_lawyer.first_name }} {{ case.assigned_lawyer.last_name }}
                                {% else %}
                                    <span class="badge unassigned">ØªØ¹ÛŒÛŒÙ† Ù†Ø´Ø¯Ù‡</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge status-{{ case.status }}">
                                    {% if case.status == 'pending' %}
                                        Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
                                    {% elif case.status == 'in_progress' %}
                                        Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ
                                    {% elif case.status == 'completed' %}
                                        ØªÚ©Ù…ÛŒÙ„â€ŒØ´Ø¯Ù‡
                                    {% else %}
                                        Ø¨Ø³ØªÙ‡â€ŒØ´Ø¯Ù‡
                                    {% endif %}
                                </span>
                            </td>
                            <td>{{ case.created_at|date:"Y-m-d" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center text-muted">Ù‡ÛŒÚ† Ù¾Ø±ÙˆÙ†Ø¯Ù‡â€ŒØ§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹ -->
        <div class="quick-actions">
            <h3>Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹</h3>
            <div class="actions-grid">
                <a href="/admin/core/casefile/add/" class="action-btn">
                    <span>â•</span>
                    <span>Ù¾Ø±ÙˆÙ†Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯</span>
                </a>
                <a href="/admin/auth/user/add/" class="action-btn">
                    <span>ğŸ‘¤</span>
                    <span>Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</span>
                </a>
                <a href="/admin/" class="action-btn">
                    <span>âš™ï¸</span>
                    <span>Ù…Ø¯ÛŒØ±ÛŒØª</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Ø¨Ø®Ø´: Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø³Ø§Ù†ÛŒ -->
    <div class="tab-content" id="hr-tab">
        <div class="tab-header">
            <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø³Ø§Ù†ÛŒ</h2>
            <div class="subtabs-nav">
                <button class="subtab-btn active" data-subtab="hr-employees">ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù†</button>
                <button class="subtab-btn" data-subtab="hr-branches">ğŸ¢ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¹Ø¨Ù‡â€ŒÙ‡Ø§</button>
                <button class="subtab-btn" data-subtab="hr-attendance">âœ“ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</button>
                <button class="subtab-btn" data-subtab="hr-reports">ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØª</button>
            </div>
        </div>

        <!-- Ù…Ø­ØªÙˆØ§ÛŒ ØªØ¨ Ù‡Ø§ÛŒ ÙØ±Ø¹ÛŒ HR -->
        <div class="subtab-content active" id="hr-employees-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ù…Ù†Ø¯Ø§Ù†</h3>
                    <a href="/admin/core/employee/add/" class="btn btn-small">â• Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¬Ø¯ÛŒØ¯</a>
                </div>
                {% if employees %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ø³Ù…Øª</th>
                                <th>Ø´Ø¹Ø¨Ù‡</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for emp in employees %}
                            <tr>
                                <td>{{ emp.user.first_name }} {{ emp.user.last_name }}</td>
                                <td>{{ emp.get_job_title_display }}</td>
                                <td>{{ emp.branch.name|default:"---" }}</td>
                                <td><span class="badge" style="background: {% if emp.is_active %}#28a745{% else %}#dc3545{% endif %}">{% if emp.is_active %}ÙØ¹Ø§Ù„{% else %}ØºÛŒØ±ÙØ¹Ø§Ù„{% endif %}</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>Ù‡ÛŒÚ† Ú©Ø§Ø±Ù…Ù†Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="subtab-content" id="hr-branches-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¹Ø¨Ù‡â€ŒÙ‡Ø§</h3>
                    <a href="/admin/core/branch/add/" class="btn btn-small">â• Ø´Ø¹Ø¨Ù‡ Ø¬Ø¯ÛŒØ¯</a>
                </div>
                {% if branches %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù… Ø´Ø¹Ø¨Ù‡</th>
                                <th>Ø¢Ø¯Ø±Ø³</th>
                                <th>ØªÙ„ÙÙ†</th>
                                <th>Ù…Ø¯ÛŒØ±</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for branch in branches %}
                            <tr>
                                <td>{{ branch.name }}</td>
                                <td>{{ branch.address }}</td>
                                <td>{{ branch.phone }}</td>
                                <td>{{ branch.manager.first_name|default:"---" }} {{ branch.manager.last_name|default:"" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>Ù‡ÛŒÚ† Ø´Ø¹Ø¨Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="subtab-content" id="hr-attendance-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</h3>
                </div>
                {% if attendances %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ú©Ø§Ø±Ù…Ù†Ø¯</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for attendance in attendances %}
                            <tr>
                                <td>{{ attendance.employee.user.first_name }} {{ attendance.employee.user.last_name }}</td>
                                <td>{{ attendance.date|date:"Y-m-d" }}</td>
                                <td><span class="badge status-{{ attendance.status }}">{{ attendance.get_status_display }}</span></td>
                                <td>{{ attendance.notes|default:"---" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>Ù‡ÛŒÚ† Ø±Ú©ÙˆØ±Ø¯ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="subtab-content" id="hr-reports-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØª</h3>
                </div>
                {% if recent_activities %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ú©Ø§Ø±Ù…Ù†Ø¯</th>
                                <th>Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                                <th>Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±ÛŒ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for activity in recent_activities %}
                            <tr>
                                <td>{{ activity.employee.user.first_name }} {{ activity.employee.user.last_name }}</td>
                                <td>{{ activity.title }}</td>
                                <td>{{ activity.date|date:"Y-m-d" }}</td>
                                <td>{{ activity.hours_worked }} Ø³Ø§Ø¹Øª</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>Ù‡ÛŒÚ† Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØªÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Ø¨Ø®Ø´: Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§Ù„ÛŒ -->
    <div class="tab-content" id="finance-tab">
        <div class="tab-header">
            <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§Ù„ÛŒ</h2>
            <div class="subtabs-nav">
                <button class="subtab-btn active" data-subtab="finance-report">ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ</button>
                <button class="subtab-btn" data-subtab="finance-revenues">ğŸ“ˆ Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§</button>
                <button class="subtab-btn" data-subtab="finance-expenses">ğŸ“‰ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</button>
            </div>
        </div>

        <div class="subtab-content active" id="finance-report-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ</h3>
                </div>
                
                <!-- Ú©Ø§Ø±Øª Ù‡Ø§ÛŒ Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“ˆ</div>
                        <div class="stat-info">
                            <p class="stat-value">{{ monthly_profit|floatformat:0 }}</p>
                            <p class="stat-label">Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ’³</div>
                        <div class="stat-info">
                            <p class="stat-value">{{ revenues|length }}</p>
                            <p class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ’¸</div>
                        <div class="stat-info">
                            <p class="stat-value">{{ expenses|length }}</p>
                            <p class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</p>
                        </div>
                    </div>
                </div>

                <!-- Ù†Ù…ÙˆØ¯Ø§Ø± 12 Ù…Ø§Ù‡Ù‡ -->
                <div class="chart-container" style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px; color: #2d3748; font-weight: 600;">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ 12 Ù…Ø§Ù‡Ù‡ (Ø¯Ø±Ø¢Ù…Ø¯ØŒ Ù‡Ø²ÛŒÙ†Ù‡ Ùˆ Ø³ÙˆØ¯)</h3>
                    <canvas id="financialChart" style="max-height: 300px;"></canvas>
                </div>

                <script>
                    // Ø¯Ø§Ø¯Ù‡ Ù‡Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ø§Ø² Ø²Ù…ÛŒÙ†Ù‡ Django
                    const months = JSON.parse('{{ months_labels|escapejs }}');
                    const revenues = JSON.parse('{{ months_revenue|escapejs }}');
                    const expenses = JSON.parse('{{ months_expense|escapejs }}');
                    const profits = JSON.parse('{{ months_profit|escapejs }}');

                    // Ø±Ø§Ù‡ Ø§Ù†Ø¯Ø§Ø²ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±
                    const ctx = document.getElementById('financialChart').getContext('2d');
                    const chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: months,
                            datasets: [
                                {
                                    label: 'Ø¯Ø±Ø¢Ù…Ø¯',
                                    data: revenues,
                                    borderColor: '#667eea',
                                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                    borderWidth: 2.5,
                                    tension: 0.4,
                                    fill: true,
                                    pointRadius: 5,
                                    pointHoverRadius: 7,
                                    pointBackgroundColor: '#667eea',
                                    pointBorderColor: '#fff',
                                    pointBorderWidth: 2,
                                },
                                {
                                    label: 'Ù‡Ø²ÛŒÙ†Ù‡',
                                    data: expenses,
                                    borderColor: '#f56565',
                                    backgroundColor: 'rgba(245, 101, 101, 0.1)',
                                    borderWidth: 2.5,
                                    tension: 0.4,
                                    fill: true,
                                    pointRadius: 5,
                                    pointHoverRadius: 7,
                                    pointBackgroundColor: '#f56565',
                                    pointBorderColor: '#fff',
                                    pointBorderWidth: 2,
                                },
                                {
                                    label: 'Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ',
                                    data: profits,
                                    borderColor: '#48bb78',
                                    backgroundColor: 'rgba(72, 187, 120, 0.1)',
                                    borderWidth: 2.5,
                                    tension: 0.4,
                                    fill: true,
                                    pointRadius: 5,
                                    pointHoverRadius: 7,
                                    pointBackgroundColor: '#48bb78',
                                    pointBorderColor: '#fff',
                                    pointBorderWidth: 2,
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top',
                                    labels: {
                                        padding: 15,
                                        font: {
                                            size: 12,
                                            weight: 'bold',
                                            family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"
                                        },
                                        color: '#2d3748',
                                        usePointStyle: true,
                                        pointStyle: 'circle'
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    padding: 12,
                                    titleFont: { size: 12, weight: 'bold' },
                                    bodyFont: { size: 11 },
                                    borderColor: '#fff',
                                    borderWidth: 1,
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.y !== null) {
                                                label += new Intl.NumberFormat('fa-IR', {
                                                    style: 'currency',
                                                    currency: 'IRR',
                                                    minimumFractionDigits: 0
                                                }).format(context.parsed.y);
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.05)',
                                        borderColor: '#e2e8f0',
                                    },
                                    ticks: {
                                        color: '#718096',
                                        font: { size: 11 }
                                    }
                                },
                                y: {
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.05)',
                                        borderColor: '#e2e8f0',
                                    },
                                    ticks: {
                                        color: '#718096',
                                        font: { size: 11 },
                                        callback: function(value) {
                                            return new Intl.NumberFormat('fa-IR', {
                                                notation: 'compact',
                                                maximumFractionDigits: 0
                                            }).format(value);
                                        }
                                    }
                                }
                            }
                        }
                    });
                </script>
            </div>
        </div>

        <div class="subtab-content" id="finance-revenues-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§</h3>
                    <a href="/admin/core/revenue/add/" class="btn btn-small">â• Ø¯Ø±Ø¢Ù…Ø¯ Ø¬Ø¯ÛŒØ¯</a>
                </div>
                {% if revenues %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>Ù…Ø¨Ù„Øº</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for revenue in revenues %}
                            <tr>
                                <td>{{ revenue.title }}</td>
                                <td>{{ revenue.get_revenue_type_display }}</td>
                                <td style="color: #28a745; font-weight: bold;">+ {{ revenue.amount|floatformat:0 }}</td>
                                <td>{{ revenue.date|date:"Y-m-d" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>Ù‡ÛŒÚ† Ø¯Ø±Ø¢Ù…Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="subtab-content" id="finance-expenses-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</h3>
                    <a href="/admin/core/expense/add/" class="btn btn-small">â• Ù‡Ø²ÛŒÙ†Ù‡ Ø¬Ø¯ÛŒØ¯</a>
                </div>
                {% if expenses %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>Ù…Ø¨Ù„Øº</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for expense in expenses %}
                            <tr>
                                <td>{{ expense.title }}</td>
                                <td>{{ expense.get_expense_type_display }}</td>
                                <td style="color: #dc3545; font-weight: bold;">- {{ expense.amount|floatformat:0 }}</td>
                                <td>{{ expense.date|date:"Y-m-d" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>Ù‡ÛŒÚ† Ù‡Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Ø¨Ø®Ø´: ÙˆØ§Ù…â€ŒÙ‡Ø§ -->
    <div class="tab-content" id="loans-tab">
        <div class="tab-header">
            <h2>ÙˆØ§Ù…â€ŒÙ‡Ø§</h2>
            <div class="subtabs-nav">
                <button class="subtab-btn active" data-subtab="loans-list">ğŸ“‹ ÙˆØ§Ù…â€ŒÙ‡Ø§</button>
                <button class="subtab-btn" data-subtab="loans-buyers">ğŸ‘¥ Ø®Ø±ÛŒØ¯Ø§Ø±Ø§Ù† ÙˆØ§Ù…</button>
                <button class="subtab-btn" data-subtab="loans-creditors">ğŸ¦ Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±Ø§Ù† ÙˆØ§Ù…</button>
            </div>
        </div>

        <div class="subtab-content active" id="loans-list-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>Ù„ÛŒØ³Øª ÙˆØ§Ù…â€ŒÙ‡Ø§</h3>
                    <a href="/admin/core/loan/add/" class="btn btn-small">â• ÙˆØ§Ù… Ø¬Ø¯ÛŒØ¯</a>
                </div>
                {% if loans %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ù…</th>
                                <th>Ù…Ø¨Ù„Øº</th>
                                <th>Ù†Ø±Ø® Ø¨Ù‡Ø±Ù‡</th>
                                <th>Ù…Ø¯Øª (Ù…Ø§Ù‡)</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for loan in loans %}
                            <tr>
                                <td><strong>{{ loan.loan_number }}</strong></td>
                                <td>{{ loan.amount|floatformat:0 }}</td>
                                <td>{{ loan.interest_rate }}%</td>
                                <td>{{ loan.duration_months }}</td>
                                <td>
                                    <span class="badge status-{{ loan.status }}">
                                        {% if loan.status == 'pending' %}
                                            Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯
                                        {% elif loan.status == 'approved' %}
                                            ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡
                                        {% elif loan.status == 'active' %}
                                            ÙØ¹Ø§Ù„
                                        {% elif loan.status == 'completed' %}
                                            ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡
                                        {% else %}
                                            Ø±Ø¯ Ø´Ø¯Ù‡
                                        {% endif %}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>Ù‡ÛŒÚ† ÙˆØ§Ù…ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="subtab-content" id="loans-buyers-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>Ø®Ø±ÛŒØ¯Ø§Ø±Ø§Ù† ÙˆØ§Ù…</h3>
                    <a href="/admin/core/loanbuyer/add/" class="btn btn-small">â• Ø®Ø±ÛŒØ¯Ø§Ø± Ø¬Ø¯ÛŒØ¯</a>
                </div>
                {% if loan_buyers %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù… Ø®Ø±ÛŒØ¯Ø§Ø±</th>
                                <th>Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ù…</th>
                                <th>Ú©Ø¯ Ù…Ù„ÛŒ</th>
                                <th>ØªÙ„ÙÙ†</th>
                                <th>Ù¾Ø±Ø¯Ø§Ø®Øª Ù…Ø§Ù‡Ø§Ù†Ù‡</th>
                                <th>Ø¨Ø¯Ù‡ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for buyer in loan_buyers %}
                            <tr>
                                <td>{{ buyer.user.first_name }} {{ buyer.user.last_name }}</td>
                                <td>{{ buyer.loan.loan_number }}</td>
                                <td>{{ buyer.national_id }}</td>
                                <td>{{ buyer.phone }}</td>
                                <td>{{ buyer.monthly_payment|floatformat:0 }}</td>
                                <td style="color: #dc3545; font-weight: bold;">{{ buyer.remaining_balance|floatformat:0 }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>Ù‡ÛŒÚ† Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="subtab-content" id="loans-creditors-subtab">
            <div class="section-full">
                <div class="section-header">
                    <h3>Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±Ø§Ù† ÙˆØ§Ù…</h3>
                    <a href="/admin/core/loancreditor/add/" class="btn btn-small">â• Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø± Ø¬Ø¯ÛŒØ¯</a>
                </div>
                {% if loan_creditors %}
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ù†Ø§Ù… Ø³Ø§Ø²Ù…Ø§Ù†</th>
                                <th>Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ù…</th>
                                <th>ØªÙ„ÙÙ†</th>
                                <th>Ù…Ø¨Ù„Øº Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ</th>
                                <th>Ø¨Ø¯Ù‡ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for creditor in loan_creditors %}
                            <tr>
                                <td>{{ creditor.organization_name }}</td>
                                <td>{{ creditor.loan.loan_number }}</td>
                                <td>{{ creditor.phone }}</td>
                                <td>{{ creditor.credit_amount|floatformat:0 }}</td>
                                <td style="color: #dc3545; font-weight: bold;">{{ creditor.remaining_debt|floatformat:0 }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>Ù‡ÛŒÚ† Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Ø¨Ø®Ø´: Ø®Ø¯Ù…Ø§Øª -->
    <div class="tab-content" id="services-tab">
        <div class="tab-header">
            <h2>Ø®Ø¯Ù…Ø§Øª</h2>
        </div>
        <div class="empty-state">
            <p>ğŸ”„ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª</p>
        </div>
    </div>

    <!-- Ø¨Ø®Ø´: Ù¾Ø±ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ -->
    <div class="tab-content" id="cases-tab">
        <div class="tab-header">
            <h2>Ù¾Ø±ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§</h2>
        </div>
        <div class="empty-state">
            <p>ğŸ”„ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª</p>
        </div>
    </div>
</div>
{% endblock %}